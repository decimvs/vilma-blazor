@inherits VilmaBasicComponent


<ul class="@_navCss" data-bs-theme="@GetColorMode()">
    <CascadingValue Value="this">
        @NavItems
    </CascadingValue>
</ul>

@code {
    /// <summary>
    /// Gets or sets the tab pages.
    /// </summary>
    [Parameter] public RenderFragment? NavItems { get; set; }

    /// <summary>
    /// Sets the active page within the tab pages at the start. 
    /// Is the 0 based index of the page.
    /// </summary>
    [Parameter] public int ActiveTab { get; set; }

    /// <summary>
    /// Gets or sets additonal css classes for the tab panel control.
    /// </summary>
    [Parameter] public string? ControlCss { get; set; }

    /// <summary>
    /// This event occurs when one of the tab pages is hidden. The closed tab 
    /// is returned.
    /// </summary>
    [Parameter] public EventCallback<VilmaTabPage> TabPageHidden { get; set; }

    /// <summary>
    /// This event occurs when one of the tab pages is shown. The opened tab
    /// is returned.
    /// </summary>
    [Parameter] public EventCallback<VilmaTabPage> TabPageShown { get; set; }

    private List<VilmaNavItem> _navItems = new List<VilmaNavItem>();
    private CssClassCollection _btnCssBase = new CssClassCollection("nav-link");
    private CssClassCollection _btnCssActive = new CssClassCollection("nav-link active");
    private CssClassCollection _navCss = new CssClassCollection();

    protected override void OnParametersSet()
    {
        _navCss.Clear();
        _navCss.Add("nav");
        _navCss.AddClasses(ControlCss);

        base.OnParametersSet();
    }

    internal void AddTabPage(VilmaNavItem page)
    {
        if (!_navItems.Contains(page))
            _navItems.Add(page);

        if (_navItems.Count - 1 == ActiveTab)
            page.SetActive(true);

        StateHasChanged();
    }

    public void ActivateTab(int index)
    {
        if (index >= 0 && index < _navItems.Count)
        {
            var tab = _navItems[index];
            tab.SetActive();
        }
    }

    internal void InvokeTabHiddedCallback(VilmaTabPage tab)
    {
        TabPageHidden.InvokeAsync(tab);
    }

    internal void InvokeTabShownCallback(VilmaTabPage tab)
    {
        TabPageShown.InvokeAsync(tab);
    }
}
